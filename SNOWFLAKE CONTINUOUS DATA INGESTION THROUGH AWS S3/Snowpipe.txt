  ---------------------------------------SNOWPIPE---------------------------------------------------------

--CREATE SNOWPIPE THAT RECOGNISES CSV THAT ARE INGESTED FROM EXTERNAL STAGE AND COPIES THE DATA INTO EXISTING TABLE

--The AUTO_INGEST=true parameter specifies to read 
--- event notifications sent from an S3 bucket to an SQS queue when new data is ready to load.

   
CREATE OR REPLACE PIPE BANK_SNOWPIPE_TRANSACTIONS  AUTO_INGEST = TRUE AS
COPY INTO DEMO_DB.PUBLIC.TRANSACTIONS--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/bank_transaction/' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = DEMO_DB.PUBLIC.AWS_BANK_CSV;



CREATE OR REPLACE PIPE BANK_SNOWPIPE_ACCOUNT  AUTO_INGEST = TRUE AS
COPY INTO BANK.PUBLIC.ACCOUNT--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/ACCOUNT/' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = BANK.PUBLIC.AWS_BANK_CSV;



---
CREATE OR REPLACE PIPE BANK_SNOWPIPE_CARD  AUTO_INGEST = TRUE AS
COPY INTO BANK.PUBLIC.CARD--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/CARD/' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = BANK.PUBLIC.AWS_BANK_CSV;




CREATE OR REPLACE PIPE BANK_SNOWPIPE_CLIENS  AUTO_INGEST = TRUE AS
COPY INTO BANK.PUBLIC.CLIENT--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/CLIENT/' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = BANK.PUBLIC.AWS_BANK_CSV;





CREATE OR REPLACE PIPE BANK_SNOWPIPE_DISPOSITION  AUTO_INGEST = TRUE AS
COPY INTO BANK.PUBLIC.DISPOSITION--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/DISPOSITION//' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = BANK.PUBLIC.AWS_BANK_CSV;





CREATE OR REPLACE PIPE BANK_SNOWPIPE_DISTRICT  AUTO_INGEST = TRUE AS
COPY INTO BANK.PUBLIC.DISTRICT--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/DISTRICT/' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = BANK.PUBLIC.AWS_BANK_CSV;




CREATE OR REPLACE PIPE BANK_SNOWPIPE_LOAN  AUTO_INGEST = TRUE AS
COPY INTO BANK.PUBLIC.LOAN--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/LOAN/' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = BANK.PUBLIC.AWS_BANK_CSV;




CREATE OR REPLACE PIPE BANK_SNOWPIPE_ORDER_LIST  AUTO_INGEST = TRUE AS
COPY INTO BANK.PUBLIC.ORDER_LIST--COPY INTO YOUR TABLE 
FROM '@BANK_STAGE/ORDER_LIST/' --(FROM @STAGING NAME FOLLOWED BY SUB FOLDER INSIDE YOUR BUCKET)
FILE_FORMAT = BANK.PUBLIC.AWS_BANK_CSV;


SHOW PIPES;

SELECT count(*) FROM DISTRICT;
SELECT count(*) FROM ACCOUNT;
SELECT count(*) FROM TRANSACTIONS;
SELECT count(*) FROM DISPOSITION;
SELECT count(*) FROM CARD;
SELECT count(*) FROM ORDER_LIST;
SELECT count(*) FROM LOAN;
SELECT count(*) FROM CLIENT;


ALTER PIPE BANK_SNOWPIPE_TRANSACTIONS refresh;


ALTER PIPE BANK_SNOWPIPE_ACCOUNT refresh;
ALTER PIPE BANK_SNOWPIPE_CARD refresh;
ALTER PIPE BANK_SNOWPIPE_CLIENS refresh;
ALTER PIPE BANK_SNOWPIPE_DISPOSITION refresh;
ALTER PIPE BANK_SNOWPIPE_DISTRICT refresh;
ALTER PIPE BANK_SNOWPIPE_LOAN refresh;
ALTER PIPE BANK_SNOWPIPE_ORDER_LIST refresh;